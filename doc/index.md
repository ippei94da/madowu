<!-- vim:syntax=markdown
-->

# Madowu, MArkDOWn to markUp

「まどう」と読みます。

Markdown で書かれたドキュメントを、
ヘッダフッタ付きのちゃんとした HTML にします。
なお、このページは madowu によって生成されています。


## インストール
    gem install madowu

## 基本的な動作

一つの md ファイルを受け取り、
拡張子を html に変更したファイルを生成します。
元々存在しても、確認なしに上書きします。

`madowu *.md` のように 複数ファイルを一度に扱えるようにはしていません。
今のところ、これは make や rake が分担すべき仕事だと考えています。

## HTML head の title 要素
HTML ではファイルで表現される文書のタイトルを
head 要素の title 要素で指定しますが、
markdown ではこれを指定する方法がありません。
Madowu では、md ファイル内で現れる最初の見出し(「#」で始まる行。レベルは1と限らない)
をページ全体のタイトルとして扱います。
すなわち、Madowu ではファイル内に h1 要素を生成するレベル1 の
「#」が 1つだけであり、これが全ての見出しの中で最初に出現することを想定しています。

## オプション
    madowu -h
でヘルプが出ます。

### -o オプション, outline を埋め込む
見出しをまとめた outline を body の先頭に埋め込みます。
markdown 処理されたマークアップテキストに、さらにアンカーとリンクを追加します。

スタイルシートを適切に準備しておけば幸せになれるでしょう。
example/madowu.css を参考にされると良いでしょう。
また、一度 example で rake を実行し、
ブラウザで生成された html 群を見てみると良いと思います。

### -O オプション, タイトル行そのものをその行へのリンクにする。
-o の機能に追加して、タイトル行そのものをその行へのリンクにします。

### -d オプション, sidebar にディレクトリマップを埋め込む
ファイルが存在するディレクトリ周囲のファイルへのリンクをまとめ、sidebar に配置します。

親ディレクトリ、同一ディレクトリ内のエントリの2種類に分類します。
ディレクトリへのリンクに関しては、index.html or index.md があれば index.html
へのリンクを作り、存在しなければ ディレクトリ自体にリンクします。
同一ディレクトリのファイルは、`foo.md` は `foo.html` になるものとして、html の名前でリンクを生成します。
また、md もしくは html ファイルでタイトル相当の情報があれば、
これを 括弧内で補助的に表示します。

これも、
スタイルシートを適切に準備しておけば幸せになれるでしょう。

### -c オプション, css ファイル指定
html 表示に適用するスタイルシートのパスを指定します。
元となる markdown ファイルのパスと指定された css ファイルのパスとの
相対パスに変換して埋め込みます。

### -C オプション, charset 指定
HTML ヘッダで指定するファイルの文字エンコーディングを指定します。
指定しない場合のデフォルト値は US-ASCII です。

### -s オプション
サイドバーに埋め込む内容のファイルを指定します。
このファイルを Markdown 処理して埋め込みます。


### -m オプション
使用する markdown コマンドを指定します。
方言を含む markdown like な処理系を指定することも可能です。

## 支援コマンド

### tex2image

LaTeX の出力を画像にします。
数式の貼り込みなどに便利だと思います。
デフォルトでは png 形式で書き出します。

* -j, --jpg オプション。png ではなく、jpg 形式で書き出します。
* -d, --density=val オプション。解像度を指定します。

### dirmap

親子関係で隣接したディレクトリへのリンクを表す .dirmap.md ファイルを Markdown 
形式で書き出します。

.dirmap.md と内容に変更がなければ書き出さず、タイムスタンプを維持します。

## example
ウェブサイトのように、ディレクトリ丸々 markdown から html に変換するような場合に
使える Rakefile のサンプルが example/ 以下にあります。
とりあえず rake して生成される index.html と
他の html を見るとだいたい感じがつかめると思います。


<!--
### ディレクトリ更新の追従
この Rakefile では html ファイル生成が md ファイルのみに依存するようになっている
ため、
ディレクトリへのファイルの追加・削除のみがあった場合には自動的にそれを補うように
更新されません。
そのため、このような目的のためには手動で強制的に html を生成する必要があります。

#### このような仕様になっている理由

ディレクトリに依存するとして Rakefile を記述すると、追加・削除がなくとも、
どれか一つのファイルを更新する度にディレクトリ内のファイルが全て madowu 処理
されることになります。
ディレクトリ内のファイルエントリが変更されなければディレクトリのタイムスタンプ
は本来更新されないのですが、
vim や emacs は foo.swp のようなスワップファイルを生成・削除するため、
ディレクトリのタイムスタンプが更新されてしまいます。
ファイル編集は通常エディタで行うことが想定されますので、
この挙動は受け入れるべきです。
そのため、1つのファイルを更新すると同時にディレクトリの更新時刻も更新され、
そのディレクトリに依存する全ての html ファイルの更新が必要と判断されるということになります。
ところが、このような挙動は多数の `*.md` ファイルが存在するディレクトリで
1つのファイルを更新しても、
rake をかけるたびに全てのファイルを更新することになり、
確認しながらの編集がストレスフルなものとなってしまいます。
このデメリットが
ディレクトリ更新を自動的に補足するメリットよりも大きいと判断したため、
example/Rakefile ではディレクトリのタイムスタンプは見ない、
という仕様に今のところなっています。

.dirmap.html のようなファイルを生成して
これを読み込むようにもしてみたことがありますが、
この場合もディレクトリの更新時刻が更新されます。
毎回 .dirmap.html が更新されるので、毎回全てのファイルが更新されてしまいます。

.dirmap.html を生成しておいて、
ファイル内容をチェックし、変更があればこれを更新、というのは一つの手かもしれません。
しかし、挙動が複雑な割に得られるメリットが少ない気がします。
-->

### 再帰的なターゲッティング
この Rakefile では `**.md` のように
1つの Rakefile で再帰的にターゲッティングしていますが、
運用によってはこのようにせず、各ディレクトリで Rakefile を配置する方が良いかもしれません。

## 関連プログラム
freestyle wiki からのデータ移動を考えている方は、
tefil に同梱してある fswiki2md が少し便利かもしれません。


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68497868-1', 'auto');
  ga('send', 'pageview');
</script>


