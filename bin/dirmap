#! /usr/bin/env ruby
# coding: utf-8

DEFAULT_OUTFILE = '.dirmap.md'

require "optparse"
require "pathname"
require "pp"
require "madowu"

### option analysis
OPTIONS = {}
op = OptionParser.new
op.banner = [
  "Usage: #{File.basename("#{__FILE__}")} dir_path",
  "   Note that indicate directory, not file."
].join("\n")
#op.on("-a"    , "--aho"    , "descriptionA"){    OPTIONS[:aho] = true}
#op.on("-b val", "--bak=val", "descriptionB"){|v| OPTIONS[:bak] = v}
#op.parse!(ARGV)

outfile = DEFAULT_OUTFILE

unless ARGV.size == 1
  puts op.banner
  exit
end

unless FileTest.directory? ARGV[0] 
  puts op.banner
  exit
end

contents = Madowu::DirectoryMapper.dirmap(ARGV[0])
if FileTest.exist? outfile
  old_contents = File.open(outfile, "r").readlines.map{|i| i.chomp}
  if old_contents == contents
    #puts "not update"
    exit
  end
end

io = File.open(outfile, 'w')
io.puts contents
#puts "update #{outfile}"
